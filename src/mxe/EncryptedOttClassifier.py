from keras.models import load_model
import numpy as np
import json
import pickle

WINDOW_SIZE = 30
START = 30
STRIDE = 1

METRICS = ['active_time-DATA_TRANSFER-UP',
                'active_time-DATA_TRANSFER-DOWN',
                'active_time-CONNECTION-SETUP',
                'active_time-ZERO_WINDOW_WAIT',
                'max_delay-DATA_TRANSFER-UP',
                'max_delay-DATA_TRANSFER-DOWN',
                'max_delay-CONNECTION_SETUP',
                'max_delay-ZERO_WINDOW_WAIT',
                'events-NEW_CONNECTION_INITIATED',
                'events-NEW_CONNECTION_ESTABLISHED',
                'events-CONNECTION_TIMEOUT',
                'events-CONNECTION_END',
                'events-CONNECTION_RESET',
                'events-NEW_PDN_SESSION']

# reshape input to be 3D [samples, timesteps, features]
def transform_to_sliding_window(data_to_convert, stride=1, window_size=30, start=0):
    transformed_data = []
    for i in range(start, data_to_convert.shape[0], stride):
        if len(data_to_convert.shape) > 1:
            timestep_window = np.pad(data_to_convert, ((window_size-1, 0), (0, 0)), mode='constant', constant_values=0)
        else:
            timestep_window = np.pad(data_to_convert, (window_size - 1, 0), mode='constant',
                                     constant_values=0)
        timestep_window = timestep_window[i:i+window_size]
        transformed_data.append(timestep_window)
    return np.array(transformed_data)

def get_value_from_json(period_object, name):
    parts = name.split('-')
    event_num = 0
    for json_object in period_object.get(parts[0], []):
        if parts[0] in ['active_time', 'max_delay']:
            if len(parts) == 3:
                if json_object['type'] == parts[1] and json_object['direction'] == parts[2]:
                    return json_object['value']
            else:
                if json_object['type'] == parts[1]:
                    return json_object['value']
        else:
            if json_object['type'] == parts[1]:
                event_num += 1
    return event_num

def extract_periods(json_data):
    data = json.loads(json_data)
    data = data['record']
    periods = data['periods']
    list_of_preprocessed_data = []
    for period in periods:
        preprocessed_data = []
        preprocessed_data.append(period['start'])
        preprocessed_data.append(period['active_connections'])
        preprocessed_data.append(period.get('bytes_down', 0))
        preprocessed_data.append(period.get('bytes_up',0))
        preprocessed_data.append(period['dur'])
        for metric in METRICS:
            preprocessed_data.append(get_value_from_json(period, metric))
        list_of_preprocessed_data.append(preprocessed_data)
    return list_of_preprocessed_data

def scale(data, scaler):
    scaled_data = scaler.transform(data)
    return scaled_data
	
class EncryptedOttClassifier(object):

	def __init__(self):
		f = open('scaler.pckl', 'rb')
		self.SCALER = pickle.load(f)
		f.close()
		self.MODEL = load_model('model.h5')
		self.MODEL.load_weights('weights.hdf5')

	def predict(self,json_data):
		preprocessed_data = extract_periods(json_data)
		print(preprocessed_data)
		preprocessed_data = np.delete(preprocessed_data, 0, 1)
		preprocessed_data = np.delete(preprocessed_data, 3, 1)
		scaled_data = scale(preprocessed_data, self.SCALER)
		scaled_data = np.array(scaled_data)
		print(scaled_data.shape)
		transformed_data = transform_to_sliding_window(scaled_data, stride=STRIDE, window_size=WINDOW_SIZE, start=START)
		print(transformed_data)
		print(np.array(transformed_data).shape)
		predictions = self.MODEL.predict(np.array(transformed_data))
		predictions = predictions.tolist()
		pred_dict = {'time_series':predictions}
		json_pred = json.dumps(pred_dict)
		return json_pred

if __name__ == '__main__':
  json_data = '{"type":"tsr","record":{"id":{"start_time":1519077487000000,"duration":174000000,"rat_type":"UNKNOWN","ip":{"v6hi":6408753676705007398,"v6lo":12541794487174269972}},"transport":"TCP","ott":"Netflix video","dominant_tags":[{"facet":"functionality","value":"video"},{"facet":"encryption","value":"TLS-SSL"},{"facet":"service-provider","value":"Netflix"}],"periods":[{"start":1519077487000000,"dur":1000000,"active_connections":1,"active_time":[{"value":13181,"type":"CONNECTION_SETUP"}],"max_delay":[{"value":13181,"type":"CONNECTION_SETUP"}],"events":[{"timestamp":1519077487986819,"type":"NEW_CONNECTION_INITIATED","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":40636,"net_addr":{"v6hi":2617205760,"v6lo":11633121944320081920},"net_port":443},"domain_name":"ipv4-c162-sea001-ix.1.oca.nflxvideo.net"}]},{"start":1519077488000000,"dur":1000000,"active_connections":1,"bytes_up":1220,"bytes_down":1322291,"active_time":[{"value":38068,"type":"DATA_TRANSFER","direction":"UP"},{"value":885890,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":28794,"type":"CONNECTION_SETUP"}],"max_delay":[{"value":15730,"type":"DATA_TRANSFER","direction":"UP"},{"value":105644,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":41975,"type":"CONNECTION_SETUP"}]},{"start":1519077489000000,"dur":1000000,"active_connections":3,"bytes_up":2003,"bytes_down":1177925,"active_time":[{"value":61321,"type":"DATA_TRANSFER","direction":"UP"},{"value":825467,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":88096,"type":"CONNECTION_SETUP"}],"max_delay":[{"value":17638,"type":"DATA_TRANSFER","direction":"UP"},{"value":106992,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":55055,"type":"CONNECTION_SETUP"}],"events":[{"timestamp":1519077489336891,"type":"CONNECTION_END","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":40636,"net_addr":{"v6hi":2617205760,"v6lo":11633121944320081920},"net_port":443},"domain_name":"ipv4-c162-sea001-ix.1.oca.nflxvideo.net"},{"timestamp":1519077489376852,"type":"NEW_CONNECTION_INITIATED","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":55936,"net_addr":{"v6hi":2617205760,"v6lo":9831682093371883520},"net_port":443},"domain_name":"ipv4-c137-sea001-ix.1.oca.nflxvideo.net"},{"timestamp":1519077489475905,"type":"NEW_CONNECTION_INITIATED","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":52302,"net_addr":{"v6hi":2617205760,"v6lo":11416949162206298112},"net_port":443},"domain_name":"ipv4-c159-sea001-ix.1.oca.nflxvideo.net"}]},{"start":1519077490000000,"dur":1000000,"active_connections":3,"bytes_up":1401,"bytes_down":854302,"active_time":[{"value":127950,"type":"DATA_TRANSFER","direction":"UP"},{"value":963740,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":68013,"type":"CONNECTION_SETUP"},{"value":339990,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":106513,"type":"DATA_TRANSFER","direction":"UP"},{"value":117819,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":68013,"type":"CONNECTION_SETUP"}],"events":[{"timestamp":1519077490078914,"type":"CONNECTION_END","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":55936,"net_addr":{"v6hi":2617205760,"v6lo":9831682093371883520},"net_port":443},"domain_name":"ipv4-c137-sea001-ix.1.oca.nflxvideo.net"},{"timestamp":1519077490078962,"type":"NEW_CONNECTION_INITIATED","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":40662,"net_addr":{"v6hi":2617205760,"v6lo":11633121944320081920},"net_port":443},"domain_name":"ipv4-c162-sea001-ix.1.oca.nflxvideo.net"}]},{"start":1519077491000000,"dur":1000000,"active_connections":2,"bytes_up":836,"bytes_down":1456125,"active_time":[{"value":13143,"type":"DATA_TRANSFER","direction":"UP"},{"value":985757,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":193093,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":6862,"type":"DATA_TRANSFER","direction":"UP"},{"value":169425,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077492000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2126353,"active_time":[{"value":7121,"type":"DATA_TRANSFER","direction":"UP"},{"value":1000000,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":621097,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7121,"type":"DATA_TRANSFER","direction":"UP"},{"value":99476,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077493000000,"dur":1000000,"active_connections":2,"bytes_up":836,"bytes_down":2053683,"active_time":[{"value":100009,"type":"DATA_TRANSFER","direction":"UP"},{"value":985827,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":488126,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":93342,"type":"DATA_TRANSFER","direction":"UP"},{"value":98927,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077494000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2113137,"active_time":[{"value":7062,"type":"DATA_TRANSFER","direction":"UP"},{"value":968954,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":569027,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7062,"type":"DATA_TRANSFER","direction":"UP"},{"value":108506,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077495000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":1947025,"active_time":[{"value":7837,"type":"DATA_TRANSFER","direction":"UP"},{"value":993208,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":552039,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7837,"type":"DATA_TRANSFER","direction":"UP"},{"value":126114,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077496000000,"dur":1000000,"active_connections":2,"bytes_up":836,"bytes_down":1667472,"active_time":[{"value":14638,"type":"DATA_TRANSFER","direction":"UP"},{"value":983342,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":376787,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7803,"type":"DATA_TRANSFER","direction":"UP"},{"value":185508,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077497000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":1752128,"active_time":[{"value":6125,"type":"DATA_TRANSFER","direction":"UP"},{"value":993371,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":4,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":6125,"type":"DATA_TRANSFER","direction":"UP"},{"value":130884,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077498000000,"dur":1000000,"active_connections":1,"bytes_up":418,"bytes_down":1770890,"active_time":[{"value":6772,"type":"DATA_TRANSFER","direction":"UP"},{"value":993228,"type":"DATA_TRANSFER","direction":"DOWN"}],"max_delay":[{"value":6772,"type":"DATA_TRANSFER","direction":"UP"},{"value":121954,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077499000000,"dur":1000000,"active_connections":1,"bytes_down":548108,"active_time":[{"value":246917,"type":"DATA_TRANSFER","direction":"DOWN"}],"max_delay":[{"value":73929,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077502000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":189838,"active_time":[{"value":5960,"type":"DATA_TRANSFER","direction":"UP"},{"value":547682,"type":"DATA_TRANSFER","direction":"DOWN"}],"max_delay":[{"value":5960,"type":"DATA_TRANSFER","direction":"UP"},{"value":130485,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077503000000,"dur":1000000,"active_connections":2,"bytes_down":1596992,"active_time":[{"value":1000000,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":83149,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":174787,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077504000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":1808826,"active_time":[{"value":6566,"type":"DATA_TRANSFER","direction":"UP"},{"value":981263,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":488019,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":6566,"type":"DATA_TRANSFER","direction":"UP"},{"value":191977,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077505000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":1665163,"active_time":[{"value":8254,"type":"DATA_TRANSFER","direction":"UP"},{"value":975637,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":371985,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":8254,"type":"DATA_TRANSFER","direction":"UP"},{"value":220830,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077506000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2236229,"active_time":[{"value":7080,"type":"DATA_TRANSFER","direction":"UP"},{"value":990951,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":656959,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7080,"type":"DATA_TRANSFER","direction":"UP"},{"value":107042,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077507000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2355438,"active_time":[{"value":6523,"type":"DATA_TRANSFER","direction":"UP"},{"value":993362,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":656056,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":6523,"type":"DATA_TRANSFER","direction":"UP"},{"value":80794,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077508000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2316593,"active_time":[{"value":7705,"type":"DATA_TRANSFER","direction":"UP"},{"value":985215,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":502804,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7705,"type":"DATA_TRANSFER","direction":"UP"},{"value":110205,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077509000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2322406,"active_time":[{"value":6675,"type":"DATA_TRANSFER","direction":"UP"},{"value":992432,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":626175,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":6675,"type":"DATA_TRANSFER","direction":"UP"},{"value":111277,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077510000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2362022,"active_time":[{"value":6576,"type":"DATA_TRANSFER","direction":"UP"},{"value":993424,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":587031,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":6576,"type":"DATA_TRANSFER","direction":"UP"},{"value":89066,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077511000000,"dur":1000000,"active_connections":2,"bytes_up":418,"bytes_down":2212473,"active_time":[{"value":7081,"type":"DATA_TRANSFER","direction":"UP"},{"value":969419,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":529935,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7081,"type":"DATA_TRANSFER","direction":"UP"},{"value":98414,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077512000000,"dur":1000000,"active_connections":2,"bytes_up":836,"bytes_down":2220996,"active_time":[{"value":14589,"type":"DATA_TRANSFER","direction":"UP"},{"value":992477,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":7523,"type":"DATA_TRANSFER","direction":"UP"},{"value":106968,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077513000000,"dur":1000000,"active_connections":2,"bytes_down":1782921,"active_time":[{"value":863906,"type":"DATA_TRANSFER","direction":"DOWN"},{"value":741002,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"max_delay":[{"value":90999,"type":"DATA_TRANSFER","direction":"DOWN"}]},{"start":1519077514000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077515000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077516000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077517000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077518000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077519000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077520000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077521000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077522000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077523000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077524000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077525000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077526000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077527000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077528000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077529000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077530000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077531000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077532000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077533000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077534000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077535000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077536000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077537000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077538000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077539000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077540000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077541000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077542000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077543000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077544000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077545000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077546000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077547000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077548000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077549000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077550000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077551000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077552000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077553000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077554000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077555000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077556000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077557000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077558000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077559000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077560000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077561000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077562000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077563000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077564000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077565000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077566000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077567000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077568000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077569000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077570000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077571000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077572000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077573000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077574000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077575000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077576000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077577000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077578000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077579000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077580000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077581000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077582000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077583000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077584000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077585000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077586000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077587000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077588000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077589000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077590000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077591000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077592000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077593000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077594000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077595000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077596000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077597000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077598000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077599000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077600000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077601000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077602000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077603000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077604000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077605000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077606000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077607000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077608000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077609000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077610000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077611000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077612000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077613000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077614000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077615000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077616000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077617000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077618000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077619000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077620000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077621000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077622000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077623000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077624000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077625000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077626000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077627000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077628000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077629000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077630000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077631000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077632000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077633000000,"dur":1000000,"active_connections":2,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"events":[{"timestamp":1519077633863906,"type":"CONNECTION_TIMEOUT","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":40662,"net_addr":{"v6hi":2617205760,"v6lo":11633121944320081920},"net_port":443},"domain_name":"ipv4-c162-sea001-ix.1.oca.nflxvideo.net"}]},{"start":1519077634000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077635000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077636000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077637000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077638000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077639000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077640000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077641000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077642000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077643000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077644000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077645000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077646000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077647000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077648000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077649000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077650000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077651000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077652000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077653000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077654000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077655000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077656000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077657000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077658000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077659000000,"dur":1000000,"active_connections":1,"active_time":[{"value":1000000,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}]},{"start":1519077660000000,"dur":1000000,"active_connections":1,"active_time":[{"value":606251,"type":"ZERO_WINDOW_WAIT","direction":"DOWN"}],"events":[{"timestamp":1519077660606251,"type":"CONNECTION_TIMEOUT","flow_id":{"term_addr":{"v6hi":6408753676705007398,"v6lo":12541794487174269972},"term_port":52302,"net_addr":{"v6hi":2617205760,"v6lo":11416949162206298112},"net_port":443},"domain_name":"ipv4-c159-sea001-ix.1.oca.nflxvideo.net"}]}]}}'
  init()
  print(predict(json_data))
